<link rel="import" href="../polymer/polymer.html">

<!--
`twitter-user-list`


@demo demo/index.html 
-->

<dom-module id="location-deviation-viewer">
  <template>
    <style>
      :host {
        display: block;
        --color-red: rgba(255, 0, 80, 1);
      }

      .container {
        transition: 1s background-color;
      }

      button {
        cursor: pointer;
      }

      header {
        position: relative;
        z-index: 1;
      }

      #select-location {
        display: flex;
        flex-direction: column;
        width: 100%;
        position: relative;
        padding: 20px 40px;
      }

      h1 {
        color: black;
        font-size: 14px;
        font-weight: bolder;
        margin-top: 10px;
        text-transform: uppercase;
      }

      #selectedLocationButton {
        flex: 1;
        border: 0;
        background-color: transparent;
        color: black;
        position: relative;
        outline: none;
        font-size: 18px;
        display: flex;
        justify-content: flex-start;
        align-items: center;
        padding: 0;
      }

      #select-location select {
        position: absolute;
        width: 25%;
        height: 54px;
        opacity: 0;
        font-size: 18px;
        top: 20px;
      }
      
      svg {
        width: 15px;
        height: 12px;
      }

      #selectedLocationButton svg {
        width: 15px;
        height: 12px;
        margin: 3px 0 0 5px;
      }

      svg g {
        fill: black;       
      }

      svg g:hover, svg g:active {
        fill: white;        
      }

      main h2 {
        width: 100%;
        height: 300px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 72px;
        margin: 0;
      }
    </style>

    <div class="container" style$="background-color: [[backgroundColor]]">

    <header>

      <nav id="select-location">
        <button id="selectedLocationButton">
          [[selectedLocation]]
          <svg viewBox="0 0 15 12" version="1.1" xmlns="http://www.w3.org/2000/svg">
              <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                <polygon transform="translate(7.700000, 6.000000) rotate(-90.000000) translate(-7.700000, -6.000000) " points="11.4 1.4 10 -1.70530257e-13 4 6 10 12 11.4 10.6 6.8 6"></polygon>
              </g>
          </svg>
          </button>
        <select value="{{selectedLocation::change}}">
          <option value="Amsterdam">Amsterdam</option>
          <option value="Berlin">Berlin</option>
          <option value="Paris">Paris</option>
        </select>
        <h1>Last Hour Deviation From Average</h1>
      </nav>

    </header>

    <main>
      <h2>[[percentage]]%</h2>
    </main>

    </div>

  </template>

  <script>
    Polymer({

      is: 'location-deviation-viewer',

      properties: {
        socketData: {
          type: Object,
          value: {"Amsterdam": {"allTime": {"averageWeight": 7.7806419845289225,"startTime": "2016-01-01T00:00:00","endTime": "2016-12-16T19:24:22"},"lastHour": {"averageWeight": 3.744332727639809,"startTime": "2016-12-16T19:24:22","endTime": "2016-12-16T20:24:22"},"deviationPercentage": -51.87630101622638},"Paris": {"allTime": {"averageWeight": 25.728447108700784,"startTime": "2016-01-01T00:00:00","endTime": "2016-12-16T19:24:22"},"lastHour": {"averageWeight": 12.991049615994141,"startTime": "2016-12-16T19:24:22","endTime": "2016-12-16T20:24:22"},"deviationPercentage": -49.50705901095422},"Berlin": {"allTime": {"averageWeight": 22.96252649891658,"startTime": "2016-01-01T00:00:00","endTime": "2016-12-16T19:24:22"},"lastHour": {"averageWeight": 3.1497333333333337,"startTime": "2016-12-16T19:24:22","endTime": "2016-12-16T20:24:22"},"deviationPercentage": -86.28315863464788}}
        },

        percentage: {
          type: Array,
          computed: '_computePercentage(selectedLocation, socketData.*)'
        },

        backgroundColor: {
          computed: '_computeBackgroundColor(percentage)'
        },

        selectedLocation: {
          type: String,
          value: 'Amsterdam'
        },

        _selectedLocationIsAmsterdam: {
          type: Boolean,
          computed: '_computeSelectedLocationIsAmsterdam(selectedLocation)'
        },

        _selectedLocationIsBerlin: {
          type: Boolean,
          computed: '_computeSelectedLocationIsBerlin(selectedLocation)'
        },

        _selectedLocationIsParis: {
          type: Boolean,
          computed: '_computeSelectedLocationIsParis(selectedLocation)'
        },

      },

      _computeSelectedLocationIsAmsterdam: function(selectedLocation) {
        return selectedLocation == 'Amsterdam';
      },

      _computeSelectedLocationIsBerlin: function(selectedLocation) {
        return selectedLocation == 'Berlin';
      },

      _computeSelectedLocationIsParis: function(selectedLocation) {
        return selectedLocation == 'Paris';
      },

      _selectLocation: function(evt) {
        this.selectedLocation = evt.target.value;
      },

      _computePercentage: function(selectedLocation, socketDataChange) {
        var socketData = socketDataChange.base;
        return parseFloat(socketData[selectedLocation].deviationPercentage.toFixed(1));
      },

      _computeBackgroundColor: function(percentage) {
        if(parseFloat(percentage) < -50) return '#00FF77';
        if(parseFloat(percentage) < -25) return '#00FFFF';
        if(parseFloat(percentage) < -10) return '#00C0FF';
        if(parseFloat(percentage) < 0) return '#FFA1FF';
        if(parseFloat(percentage) < 10) return '#FFDA00';
        if(parseFloat(percentage) < 25) return '#FF8700';
        return '#FF0050';
      }

    });
  </script>
</dom-module>
